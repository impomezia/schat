function alignChat(){if(Settings.scroll){var a=window.innerHeight;if(a>0){var b=window.Chat,c=b.offsetHeight;a-c>0?(b.style.position="relative",b.style.top=a-c-4+"px"):b.style.position="static"}Settings.autoscroll&&(document.body.scrollTop=document.body.offsetHeight)}}function showSeconds(a){a?$("#body").removeClass("no-seconds"):$("#body").addClass("no-seconds")}function showService(a){a?$("#body").removeClass("no-service"):$("#body").addClass("no-service"),alignChat()}function htmlspecialchars(a,b,c,d){var e=0,f=0,g=!1;if(("undefined"==typeof b||null===b)&&(b=2),"string"!=typeof a)return"";a=a.toString(),d!==!1&&(a=a.replace(/&/g,"&amp;")),a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");var h={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===b&&(g=!0),"number"!=typeof b){for(b=[].concat(b),f=0;f<b.length;f++)0===h[b[f]]?g=!0:h[b[f]]&&(e|=h[b[f]]);b=e}return b&h.ENT_HTML_QUOTE_SINGLE&&(a=a.replace(/'/g,"&#039;")),g||(a=a.replace(/"/g,"&quot;")),a}var FEED_METHOD_GET="get",FEED_METHOD_PUT="put",FEED_METHOD_POST="post",FEED_METHOD_DELETE="delete",FEED_NAME_ACL="acl",FEED_NAME_CONSOLE="console",FEED_NAME_HOSTS="hosts",FEED_NAME_INFO="info",FEED_NAME_LIST="list",FEED_NAME_MESSAGES="messages",FEED_NAME_PROFILE="profile",FEED_NAME_SERVER="server",FEED_NAME_USER="user",FEED_NAME_USERS="users",SERVER_FEED_AUTH_KEY="auth",SERVER_FEED_AUTH_REQ="server/auth",SERVER_FEED_POLICY_KEY="policy",SERVER_FEED_POLICY_REQ="server/policy",SERVER_FEED_OAUTH_KEY="oauth",SERVER_FEED_OAUTH_REQ="server/oauth",CONSOLE_FEED_ME_KEY="me",CONSOLE_FEED_ME_REQ="console/me",INFO_FEED_LOGGING_KEY="logging",INFO_FEED_LOGGING_REQ="info/logging",INFO_FEED_PINNED_KEY="pinned",INFO_FEED_PINNED_REQ="info/pinned",INFO_FEED_SUDO_REQ="info/sudo",INFO_FEED_TITLE_REQ="info/title",INFO_FEED_VISIBILITY_REQ="info/visibility",ACL_FEED_HEAD_OTHER_REQ="acl/head/other",ACL_FEED_HEAD_OWNER_REQ="acl/head/owner",ACL_FEED_HEAD_MASK_REQ="acl/head/mask",LIST_FEED_ID_REQ="list/id",Settings={id:"",status:"",scroll:!1,scrollTo:null,autoscroll:SimpleChat.value("AutoScroll"),getId:function(){return""==Settings.id&&(Settings.id=ChatView.getId()),Settings.id},changed:function(a,b){"AutoScroll"==a&&(Settings.autoscroll=b,b===!0&&alignChat())}},Utils={left:function(a,b){return"string"!=typeof a?"":a.length<b?a:a.slice(0,b)},retranslate:function(){$("[data-tr]").each(function(){Utils.TR($(this).attr("data-tr"))})},simplified:function(a){return $.trim(a.replace(/\s+/gi," "))},table:function(a){var b="<table><tbody>";for(var c in a)a.hasOwnProperty(c)&&(b+="<tr><td>"+Utils.tr(c)+"</td><td>"+a[c]+"</td></tr>");return b+="</table></tbody>"},tr:function(a){return SimpleChat.translate(a)},TR:function(a){$("[data-tr='"+a+"']").html(Utils.tr(a))},row:function(a,b){if("string"!=typeof b||""===b)return"";var c='<div class="field-row field-'+a+'">';return c+='<span class="field-row-label"><span data-tr="'+a+'">'+Utils.tr(a)+"</span>:</span> ",c+='<span class="field-row-value">'+b+"</span>"},adjustWidth:function(a){if(a.length&&!(a.width()<1)&&a.is(":visible")){a.css("width","");var b=0,c=0;a.each(function(){c=$(this).width(),c>b&&(b=c)}),a.width(b+4)}}},Pages={current:0,onInfo:[],onMessages:[],os:function(a){return 0==a||a>79?"unknown":a>=1&&20>a?"windows":a>=20&&40>a?"osx":41==a?"ubuntu":42==a?"gentoo":43==a?"debian":44==a?"opensuse":45==a?"fedora":79==a?"android":a>=40?"linux":"unknown"},setPage:function(a){if(SimpleChat.setTabPage(Settings.id,a),Pages.current=a,0==a){$("#page-switcher-start").hide(),$("#page-switcher-end").show(),$("#messages").addClass("active"),$("#info").removeClass("active"),alignChat();for(var b=0;b<Pages.onMessages.length;b++)Pages.onMessages[b]()}else if(1==a)for($("#page-switcher-start").show(),$("#page-switcher-end").hide(),$("#messages").removeClass("active"),$("#info").addClass("active"),b=0;b<Pages.onInfo.length;b++)Pages.onInfo[b]()}};Pages.onInfo.push(function(){var a=SimpleChat.channel(Settings.getId());null!==a&&$("#channel-name").html(Messages.nameTemplate(a))});var Messages={onAdd:[],onBulkAdd:[],unhandled:[],added:[],add:function(a){Messages.added.push(a)},feed:function(a){if(200==a.status&&a.feed==FEED_NAME_MESSAGES&&a.cmd==FEED_METHOD_DELETE){var b=a.name.split("/",2);if(2==b.length){var c=document.getElementById(b[1]);if(null!==c)try{Messages[(c.getAttribute("data-remover")||"generic")+"Remover"](c),alignChat()}catch(d){console.error(d)}}}},genericRemover:function(a){var b=a.firstChild;b.classList.add("removed"),b.children[2].innerHTML='<span class="message-removed" data-tr="message-removed">'+Utils.tr("message-removed")+'</span> <i class="message-trash"></i>'},setMessageId:function(a,b){b.hasOwnProperty("OID")?(a.id=b.OID,a.setAttribute("data-mdate",b.MDate)):a.id=b.Id},addChannelMessage:function(a){var b=null;if(a.hasOwnProperty("InternalId")&&(b=document.getElementById(a.InternalId),null!==b))return void Messages.updateChannelMessage(b,a);if(b=document.getElementById(a.hasOwnProperty("OID")?a.OID:a.Id),null!==b)return void Messages.updateChannelMessage(b,a);var c=document.createElement("div");Messages.setMessageId(c,a),c.setAttribute("class","container "+a.Type+"-type"),c.setAttribute("data-time",a.Date);var d='<div class="blocks ';d+=a.Direction,void 0!==a.Status&&(d+=" "+a.Status),"me"==a.Command&&(d+=" me-action"),d+='">',d+=DateTime.template(a.Date,a.Day),d+=Messages.nameBlock(a.Author),d+='<span class="msg-body-block">'+a.Text+"</span>",d+="</div>",c.innerHTML=d,Messages.addHintedRawMessage(c,a.Hint),a.hasOwnProperty("Status")&&"undelivered"==a.Status||ChatView.setLastMessage(a.Date)},addHintedRawMessage:function(a,b){if("before"==b.Hint){var c=document.getElementById(b.Id);if(null!==c)return c.parentNode.insertBefore(a,c),void Messages.add(a.id)}Messages.addRawMessage(a,b.Day)},addMessage:function(a){var b=a.Func;if(void 0!=b&&Messages.hasOwnProperty(b))try{"unhandled"!==a.Type&&Messages.day(a.Hint.Day),Messages[b](a)}catch(c){console.error(c)}},addMessages:function(a){if(a.length){var b=Messages,c=Settings.scroll,d=Settings.scrollTo;Settings.scroll=!1,Settings.scrollTo=null;for(var e=0;e<a.length;e++)b.addMessage(a[e]);for(e=0;e<b.added.length;e++)for(var f=0;f<b.onAdd.length;f++)b.onAdd[f](b.added[e]);for(e=0;e<b.onBulkAdd.length;e++)b.onBulkAdd[e](b.added);Settings.scroll=c,b.added.length?b.added.length=0:null===Settings.scrollTo&&(Settings.scrollTo=d),alignChat(),null!==Settings.scrollTo&&document.getElementById(Settings.scrollTo).scrollIntoView()}},addRawMessage:function(a){window.Chat.appendChild(a),Messages.add(a.id)},addServiceMessage:function(a){var b=document.createElement("div");b.id=a.Id,b.setAttribute("class","container "+a.Type+"-type"),b.innerHTML='<div class="blocks '+(void 0!==a.Extra?a.Extra:"")+'">'+DateTime.template(a.Date,!1)+Messages.nameBlock(a.Author)+'<span class="msg-body-block">'+a.Text+"</span></div>",Messages.addRawMessage(b,a.Hint.Day)},addAlertMessage:function(a){var b=document.createElement("div");b.id=a.Id,b.setAttribute("class","container "+a.Type+"-type"),b.innerHTML='<div class="blocks '+(void 0!==a.Extra?a.Extra:"")+'"><div class="alert-box"><div class="alert-box-icon"></div><div class="alert-box-body">'+a.Text+'</div><div class="alert-box-buttons"><a class="alert-box-close" href="#" data-id="'+a.Id+'"></a></div></div></div>',Messages.addRawMessage(b,a.Hint.Day)},addUnhandledMessage:function(a){for(var b=0;b<Messages.unhandled.length;b++)Messages.unhandled[b](a)},nameBlock:function(a){var b=Messages.nameTemplate(a);return""==b?b:'<span class="nick-block">'+b+"</span> "},nameTemplate:function(a){return void 0===a?"":'<a class="nick '+a.Id+" color-"+a.Color+'" href="'+a.Url+'">'+htmlspecialchars(a.Name)+"</a>"},reload:function(){0==Pages.current&&($(".container").remove(),alignChat())},updateChannelMessage:function(a,b){Messages.setMessageId(a,b);var c=b.Direction;void 0!==b.Status&&(c+=" "+b.Status),"me"==b.Command&&(c+=" me-action");var d=a.firstChild;if(d.setAttribute("class","blocks "+c),b.Date>0&&a.getAttribute("data-time")!=b.Date){var e=new Date(b.Date);d.firstChild.innerHTML='<span class="time">'+DateTime.time(e)+'</span><span class="seconds">'+DateTime.seconds(e)+"</span> ",a.setAttribute("data-time",b.Date),ChatView.setLastMessage(b.Date)}},day:function(){},rename:function(a){var b=$("a."+a.Id);b.attr("href",a.Url),b.html(htmlspecialchars(a.Name))},recolor:function(a){var b=$("a."+a.Id);b.removeClassRegEx(/^color-/),b.addClass("color-"+a.Color)}},DateTime={day:function(a){return DateTime.pad(a.getDate())+"."+DateTime.pad(a.getMonth()+1)+"."+a.getFullYear()},dayId:function(a){return a.getFullYear()+"_"+DateTime.pad(a.getMonth()+1)+"_"+DateTime.pad(a.getDate())},pad:function(a){return 10>a?"0"+a:a},seconds:function(a){return":"+DateTime.pad(a.getSeconds())},template:function(a,b){if(a>0){var c=new Date(a),d='<span class="date-time-block">';return b===!0&&(d+='<span class="day">'+DateTime.day(c)+"</span> "),d+='<span class="time">'+DateTime.time(c)+'</span><span class="seconds">'+DateTime.seconds(c)+"</span> </span>"}return""},time:function(a){return DateTime.pad(a.getHours())+":"+DateTime.pad(a.getMinutes())}},Loader={jsfiles:[],done:function(){ChatView.loadFinished(),alignChat()},load:function(a){for(var b=0;b<a.length;b++)Loader.jsfiles.push(a[b]);for(b=0;b<Loader.jsfiles.length;b++)Loader.loadJS(Loader.jsfiles[b])},loadCSS:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b)},loadJS:function(a,b){$.ajax({url:a,dataType:"script",isLocal:!0,success:function(){Loader.remove(a),"function"==typeof b&&b()},error:function(){Loader.remove(a)}})},remove:function(a){var b=Loader.jsfiles.indexOf(a);-1!==b&&(Loader.jsfiles.splice(b,1),0===Loader.jsfiles.length&&Loader.done())},spinner:{tasks:[],current:null,add:function(a){if(null===Loader.spinner.current||Loader.spinner.current!=a){var b=a.split("/")[0];Loader.spinner.current=a,$("#loading-text").html(Utils.tr(b)),$("#loading-text").attr("data-tr",b),$("#loading-body").fadeIn("fast");var c=Loader.spinner.tasks,d=c.indexOf(a);-1!=d&&c.splice(d,1),c.unshift(a)}},remove:function(a){Loader.spinner.current=null;var b=Loader.spinner.tasks,c=b.indexOf(a);-1!=c&&(b.splice(c,1),0==c&&(Loader.spinner.current=null,b.length?Loader.spinner.add(b[0]):$("#loading-body").fadeOut("fast")))},prepare:function(a,b){return 302==b?(Loader.spinner.add("loading/"+a),!0):(Loader.spinner.remove("loading/"+a),200==b||300==b)}}},Modal={current:null,create:{},hidden:{},shown:{},init:function(){var a=$("body"),b=$("#modal");a.on("click.modal",".modal-toggle",function(a){a.preventDefault();var b=$(this).attr("data-handler");if(void 0!==b&&Modal.create.hasOwnProperty(b)){if(Modal.create[b](a)===!1)return;Modal.current=b}$("#modal").modal()}),b.on("hidden",function(){Modal.hidden.hasOwnProperty(Modal.current)&&Modal.hidden[Modal.current](),$("#modal-header h3 *").remove(),$("#modal-body *").remove(),Modal.current=null}),b.on("shown",function(){Modal.shown.hasOwnProperty(Modal.current)&&Modal.shown[Modal.current]()}),a.on("click",'[data-dismiss="alert"]',function(a){a.preventDefault(),$(this).parent().remove(),alignChat()})}};$(document).ready(function(){window.Chat=document.getElementById("Chat"),window.addEventListener("resize",alignChat),document.getElementById("page-switcher-start").addEventListener("click",function(){Pages.setPage(0)}),document.getElementById("page-switcher-end").addEventListener("click",function(){Pages.setPage(1)});var a=ChatView.jsfiles();return 0===a.length?void Loader.done():($("body").on("click",".alert-box-close",function(a){a.preventDefault(),$("#"+$(this).attr("data-id")).remove(),alignChat()}),Modal.init(),void Loader.load(a))}),function(a){a.fn.removeClassRegEx=function(b){var c=a(this).attr("class");if(!c||!b)return!1;var d=[];c=c.split(" ");for(var e=0,f=c.length;f>e;e++)c[e].match(b)||d.push(c[e]);a(this).attr("class",d.join(" "))}}(jQuery),"undefined"==typeof SimpleChat?SimpleChat={bytesToHuman:function(){return"0 bytes"},channel:function(){return"{}"},day:function(a){return a},encryption:function(){return!1},feed:function(){return!1},get:function(){},id:function(){return""},isOnline:function(){return!0},match:function(){return-1},mdate:function(){return 0},randomId:function(){return""},request:function(){},serverId:function(){return""},serverPeer:function(){return""},setTabPage:function(){},status:function(){return"Offline"},statusText:function(){return""},toBase32:function(){return""},traffic:function(){return{tx:0,rx:0}},translate:function(a){return a},value:function(){return null},pinTab:function(){},aclToInt:function(){return 6}}:(SimpleChat.retranslated.connect(Utils.retranslate),SimpleChat.renamed.connect(Messages.rename),SimpleChat.recolored.connect(Messages.recolor),SimpleChat.settingsChanged.connect(Settings.changed)),"undefined"==typeof ChatView?ChatView={jsfiles:function(){return[]},loadFinished:function(){},getId:function(){return""},setLastMessage:function(){},removeDay:function(){},allowFocus:function(){}}:(ChatView.reload.connect(Messages.reload),ChatView.messages.connect(Messages.addMessages),ChatView.feed.connect(Messages.feed));