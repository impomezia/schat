$.extend(jQuery,{JSONView:function(a,b){var c;c="string"==typeof a?JSON.parse(a):a;var d=[],e=b,f=function(a,b){return new Array(b+1).join(a)},g=function(a,b,c){for(var e in a){var f=a[e];switch(typeof f){case"function":break;case"string":d.push(b?{Text:'<span class="jsonstring">"'+htmlspecialchars(f)+'"</span><span class="jsontag">,</span>',Step:c}:{Text:'<span class="jsonname">"'+htmlspecialchars(e)+'"</span><span class="jsontag">: </span><span class="jsonstring">"'+htmlspecialchars(f)+'"</span><span class="jsontag">,</span>',Step:c});break;case"boolean":d.push(b?{Text:'<span class="jsonboolean">"'+f+'"</span><span class="jsontag">,</span>',Step:c}:{Text:'<span class="jsonname">"'+htmlspecialchars(e)+'"</span><span class="jsontag">: </span><span class="jsonboolean">'+f+'</span><span class="jsontag">,</span>',Step:c});break;case"number":d.push(b?{Text:'<span class="jsonnumber">'+f+'</span><span class="jsontag">,</span>',Step:c}:{Text:'<span class="jsonname">"'+htmlspecialchars(e)+'"</span><span class="jsontag">: </span><span class="jsonnumber">'+f+'</span><span class="jsontag">,</span>',Step:c});break;case"object":null===f?d.push(b?{Text:'<span class="jsonnull">'+f+'</span><span class="jsontag">,</span>',Step:c}:{Text:'<span class="jsonname">"'+htmlspecialchars(e)+'"</span><span class="jsontag">: </span><span class="jsonnull">'+f+'</span><span class="jsontag">,</span>',Step:c}):void 0==f.length?(b||d.push({Text:'<span class="jsonname">"'+htmlspecialchars(e)+'"</span><span class="jsontag">:</span>',Step:c}),d.push({Text:'<span class="jsontag">{</span>',Step:c}),g(f,!1,c+1),d.push({Text:'<span class="jsontag">},</span>',Step:c})):(b||d.push({Text:'<span class="jsonname">"'+htmlspecialchars(e)+'"</span><span class="jsontag">:</span>',Step:c}),d.push({Text:'<span class="jsontag">[</span>',Step:c}),g(f,!0,c+1),d.push({Text:'<span class="jsontag">],</span>',Step:c}))}}var h=d.pop(),i=",</span>";d.push(h.Text.substr(h.Text.length-i.length)==i?{Text:h.Text.replace(i,"</span>"),Step:h.Step}:h)};void 0==c.length?(d.push({Text:'<span class="jsontag">{</span>',Step:0}),g(c,!1,1),d.push({Text:'<span class="jsontag">}</span>',Step:0})):(d.push({Text:'<span class="jsontag">[</span>',Step:0}),g(c,!0,1),d.push({Text:'<span class="jsontag">]</span>',Step:0}));var h=!0;e.addClass("KelpJSONView"),e.append("<ol></ol>"),e=e.find("ol");for(var i in d){var j=d[i];h?(e.append($('<li class="jsonhighlight">'+f("&nbsp; ",j.Step)+j.Text+"</li>")),h=!1):(e.append($("<li>"+f("&nbsp; ",j.Step)+j.Text+"</li>")),h=!0)}}}),RawFeeds={headers:function(a){var b='<div class="feeds-headers">';for(var c in a)a.hasOwnProperty(c)&&(b+=RawFeeds.feed(c,a[c]));return b+="</div>"},feed:function(a,b){return'<div class="feed-header">'+RawFeeds.icon(b.cached)+DateTime.template(b.date,!0)+' <a href="#" class="feed-name">'+a+"</a></div>"},feedInfo:function(a){return'<div class="feed-info">Last modified: <b>'+DateTime.template(a.date,!0)+"</b><br>Size: <b>"+a.size+"</b></div>"},raw:function(a){if(a.Text.length){var b=a.Id;$("#"+b+" .raw-feeds-title").append(' <a class="btn btn-toggle" id=""><i class="icon-plus-small"></i></a>'),$.JSONView(a.Text,$("#"+b+" .jsonoutput")),$("#"+b+" .btn-toggle").on("click",function(){var a=$(this).children();"icon-plus-small"==a.attr("class")?($("#"+b+" .jsonoutput").show(),a.attr("class","icon-minus-small")):($("#"+b+" .jsonoutput").hide(),a.attr("class","icon-plus-small")),alignChat()})}},icon:function(a){return'<i class="icon-feed'+(a?"-cached":"")+'"></i> '}},Messages.addRawFeedsMessage=function(a){var b=document.createElement("div");b.id=a.Id,b.setAttribute("class","container "+a.Type+"-type");var c='<div class="blocks ';void 0!==a.Extra&&(c+=a.Extra),c+='"><div class="alert '+(200==a.Status.Code?"alert-info":"alert-error")+'"><a class="close" data-dismiss="alert" href="#">Ã—</a>',c+='<div class="raw-feeds-header">',c+='<h3 class="raw-feeds-title">'+a.Title+"</h3>",200!=a.Status.Code&&(c+=' <span class="raw-feeds-bad-status">'+a.Status.Code+" "+a.Status.Desc+"</span>"),c+="</div>";var d=a.Command;"headers"==d?c+=RawFeeds.headers(a.Data):"feed"==d&&(c+=RawFeeds.feedInfo(a.Data)),c+='<div class="jsonoutput" style="display:none;"></div>',c+="</div>",c+="</div>",b.innerHTML=c,Messages.addRawMessage(b,a.Hint.Day),RawFeeds.raw(a),"feed"==d&&$("#"+a.Id+" .raw-feeds-title").addClass("raw-feeds-title-icon"),alignChat()},$(document).ready(function(){$("body").on("click",".feed-name",function(a){a.preventDefault(),SimpleChat.feed(Settings.id,$(this).text(),2)})});